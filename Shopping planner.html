<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Shopping Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is designed as an interactive dashboard. This structure was chosen over a static table to make the shopping list actionable and insightful. The core features are dynamic filtering by retailer and category, allowing a user to instantly create a shopping list for a specific store (e.g., "What do I need from Asda?"). This is paired with a summary statistics section for a quick overview and a donut chart to visualize the distribution of items per retailer. This user flow—from overview, to visualization, to specific filtering—transforms the raw data into a practical planning tool, enhancing usability far beyond a simple list. -->
    <!-- Visualization & Content Choices: The CSV data is presented using three methods: 1) Summary Stat Cards (HTML/CSS) to inform the user of key totals at a glance. 2) A Donut Chart (Chart.js/Canvas) to visually compare the proportion of items from each retailer, helping to understand the overall shopping strategy. Interaction is via tooltips on hover. This was chosen for its high impact in showing part-to-whole relationships. 3) An Interactive Card Grid (HTML/CSS updated with JS) to organize and display individual items. Users can filter this grid, which is a more engaging and responsive way to explore the list than a static table. Justification: This combination of elements provides a multi-faceted view of the data, catering to both quick analysis and detailed exploration. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #4A4A4A;
        }
        .filter-btn {
            transition: all 0.2s ease-in-out;
        }
        .filter-btn.active {
            background-color: #A88B79;
            color: #FFFFFF;
            font-weight: 600;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-[#6D5D53]">Household Shopping Planner</h1>
            <p class="mt-2 text-lg text-[#8C7B70]">Your interactive guide to smart and efficient shopping.</p>
        </header>

        <section id="summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        </section>

        <section id="add-item-section" class="mb-8 bg-white rounded-2xl shadow-lg p-4 sm:p-6">
            <h2 class="text-xl font-bold text-[#6D5D53] mb-4">Add a New Item</h2>
            <form id="add-item-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                <input type="text" id="item-name" placeholder="Item Name" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79] lg:col-span-1" required>
                <input type="text" id="item-category" placeholder="Category" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79] lg:col-span-1" required>
                <input type="text" id="item-retailer" placeholder="Retailer" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79] lg:col-span-1" required>
                <input type="text" id="item-notes" placeholder="Notes" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79] md:col-span-2 lg:col-span-1">
                <button type="submit" class="bg-[#A88B79] text-white font-semibold p-2 rounded-lg hover:bg-[#937866] transition-colors md:col-span-2 lg:col-span-1">Add Item</button>
            </form>
        </section>

        <main class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-[#6D5D53] mb-3">Filter Your List</h2>
                 <div class="flex flex-wrap gap-2 mb-4 items-center">
                    <label for="category-filter" class="sr-only">Filter by Category</label>
                    <select id="category-filter" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]">
                        <option value="all">All Categories</option>
                    </select>
                    <label for="retailer-filter" class="sr-only">Filter by Retailer</label>
                    <select id="retailer-filter" class="p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]">
                        <option value="all">All Retailers</option>
                    </select>
                    <button id="scan-all-btn" class="bg-[#6D5D53] text-white font-semibold p-2 rounded-lg hover:bg-[#5a4d44] transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" /></svg>
                        Scan All Visible
                    </button>
                 </div>
            </div>

            <div class="lg:grid lg:grid-cols-3 lg:gap-8">
                <div class="lg:col-span-1 mb-8 lg:mb-0">
                    <h3 class="text-xl font-bold text-center text-[#6D5D53] mb-4">Shopping Distribution</h3>
                    <p class="text-center text-sm text-[#8C7B70] mb-4">This chart shows where your items are sourced from, helping you plan your trips effectively.</p>
                    <div class="chart-container">
                        <canvas id="retailerChart"></canvas>
                    </div>
                </div>

                <div id="shopping-list" class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4 content-start">
                </div>
            </div>
        </main>
    </div>

    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
            <h2 class="text-xl font-bold text-[#6D5D53] mb-4">Edit Item</h2>
            <form id="edit-item-form">
                <input type="hidden" id="edit-item-index">
                <div class="mb-4">
                    <label for="edit-item-name" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                    <input type="text" id="edit-item-name" class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]" required>
                </div>
                <div class="mb-4">
                    <label for="edit-item-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                    <input type="text" id="edit-item-category" class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]" required>
                </div>
                 <div class="mb-4">
                    <label for="edit-item-retailer" class="block text-sm font-medium text-gray-700 mb-1">Retailer</label>
                    <input type="text" id="edit-item-retailer" class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]" required>
                </div>
                <div class="mb-4">
                    <label for="edit-item-notes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <input type="text" id="edit-item-notes" class="w-full p-2 border rounded-lg bg-gray-50 focus:ring-2 focus:ring-[#A88B79] focus:border-[#A88B79]">
                </div>
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancel-edit" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">Cancel</button>
                    <button type="submit" class="bg-[#A88B79] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#937866] transition-colors">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let shoppingData = [
            { category: "Household Cleaning", item: "Dishwasher Tablets/Pods", retailer: "Amazon Subscribe & Save", notes: "Bulk buy brands like Fairy or Finish. Set a delivery frequency (e.g., every 2-3 months) for savings and convenience." },
            { category: "Household Cleaning", item: "Washing Machine Pods", retailer: "Amazon Subscribe & Save", notes: "Buying in bulk offers significant savings." },
            { category: "Household Cleaning", item: "Fabric Softener (e.g., Comfort)", retailer: "Amazon Subscribe & Save", notes: "Large bottles on subscription are often cheaper per wash than supermarket prices." },
            { category: "Household Cleaning", item: "All-Purpose/Multi-Purpose Cleaner", retailer: "Amazon Subscribe & Save", notes: "Brands like Dettol offer multi-packs. Good to have on subscription." },
            { category: "Household Cleaning", item: "Kitchen Cleaner Spray", retailer: "Amazon Subscribe & Save", notes: "Dettol Power & Pure or similar can be added to your recurring Amazon delivery." },
            { category: "Household Cleaning", item: "Toilet Cleaner Gel (e.g., Harpic)", retailer: "Asda", notes: "Buy multi-packs when on offer during your regular grocery shop." },
            { category: "Household Cleaning", item: "Bleach / Disinfectant", retailer: "Asda", notes: "Add to your weekly/bi-weekly Asda delivery as needed." },
            { category: "Household Cleaning", item: "Floor Cleaner", retailer: "Asda", notes: "Purchase as required with your main grocery delivery." },
            { category: "Household Cleaning", item: "Glass Cleaner", retailer: "Asda", notes: "Add to your Asda basket when running low." },
            { category: "Household Cleaning", item: "Furniture Polish", retailer: "Asda", notes: "Add to your Asda basket when running low." },
            { category: "Household Cleaning", item: "Air Freshener Plug-in Refills", retailer: "Amazon Subscribe & Save", notes: "Twin packs of Febreze or Air Wick are ideal for Subscribe & Save." },
            { category: "Household Cleaning", item: "Dish Soap (Washing Up Liquid)", retailer: "Amazon Subscribe & Save", notes: "Large bottles of brands like Fairy Max Power are cost-effective on subscription." },
            { category: "Kitchen Supplies", item: "Kitchen Roll (e.g., Regina Blitz)", retailer: "Amazon Subscribe & Save", notes: "Bulk packs offer the best value per sheet. Set for delivery every 1-2 months." },
            { category: "Toiletries", item: "Toilet Paper (e.g., Andrex)", retailer: "Amazon Subscribe & Save", notes: "Buying large packs (16+ rolls) on subscription is almost always cheaper per roll." },
            { category: "Kitchen Supplies", item: "Trash Bags / Caddy Liners", retailer: "Asda", notes: "Check for Asda's own-brand multi-packs for good value." },
            { category: "Kitchen Supplies", item: "Kitchen Foil", retailer: "Asda", notes: "Add to your grocery order." },
            { category: "Kitchen Supplies", item: "Cling Film", retailer: "Asda", notes: "Add to your grocery order." },
            { category: "Kitchen Supplies", item: "Baking Paper", retailer: "Asda", notes: "Add to your grocery order." },
            { category: "Kitchen Supplies", item: "Sponges (Cleaning & Dishwashing)", retailer: "Amazon", notes: "Buy large multi-packs of sponges on Amazon; much cheaper than supermarket prices." },
            { category: "Kitchen Supplies", item: "Rubber Gloves", retailer: "Asda", notes: "Add a pair to your grocery order when needed." },
            { category: "Kitchen Supplies", item: "Dish Towels / Pot Holders", retailer: "Amazon / Asda", notes: "Purchase as needed. Amazon often has better value multi-packs." },
            { category: "Pantry Staples", item: "Sunflower Oil (e.g., KTC 5L)", retailer: "Asda", notes: "Large 5-litre bottles offer the best long-term value." },
            { category: "Pantry Staples", item: "Olive Oil", retailer: "Asda", notes: "Look for promotions on 1-litre bottles." },
            { category: "Pantry Staples", item: "Basmati Rice (e.g., Tilda)", retailer: "Asda / Amazon", notes: "Large bags (5kg+) from Asda are good value. Check Amazon for bulk deals too." },
            { category: "Pantry Staples", item: "Arborio Rice", retailer: "Asda", notes: "Add to your regular grocery shop." },
            { category: "Pantry Staples", item: "Pasta", retailer: "Asda", notes: "Asda's own-brand pasta is very cost-effective, especially in larger bags." },
            { category: "Pantry Staples", item: "Canned Chopped Tomatoes", retailer: "Asda", notes: "Buy in multi-packs (4-6 cans) for a lower price per can." },
            { category: "Pantry Staples", item: "Canned Plum Tomatoes", retailer: "Asda", notes: "Buy in multi-packs." },
            { category: "Pantry Staples", item: "Canned Chickpeas", retailer: "Asda", notes: "Stock up when on offer." },
            { category: "Pantry Staples", item: "Canned Cannellini Beans", retailer: "Asda", notes: "Asda's own brand is a good value option." },
            { category: "Pantry Staples", item: "Canned Mushrooms", retailer: "Asda", notes: "Just Essentials by Asda range is a very cheap option." },
            { category: "Pantry Staples", item: "Canned Sweetcorn", retailer: "Asda", notes: "Multi-packs of brands like Green Giant offer good value." },
            { category: "Pantry Staples", item: "Canned Tuna", retailer: "Asda", notes: "Buy in multi-packs." },
            { category: "Pantry Staples", item: "Canned Baked Beans", retailer: "Asda", notes: "Stock up on multi-packs when they are on special offer." },
            { category: "Pantry Staples", item: "Canned Lentils / Green Beans", retailer: "Asda", notes: "Add as needed to your grocery shop." },
            { category: "Pantry Staples", item: "Ketchup (e.g., Heinz)", retailer: "Asda", notes: "Buy the largest bottle size available for the best price per 100g." },
            { category: "Pantry Staples", item: "Mayonnaise (e.g., Heinz)", retailer: "Asda", notes: "Larger jars/bottles are better value." },
            { category: "Pantry Staples", item: "Mustard", retailer: "Asda", notes: "Purchase as needed." },
            { category: "Pantry Staples", item: "Salt & Pepper", retailer: "Asda", notes: "Purchase grinders or refill packs as needed." },
            { category: "Pantry Staples", item: "Spices (e.g., Prymat)", retailer: "Asda", notes: "Add to your grocery shop as required." },
            { category: "Pantry Staples", item: "Flour / Polenta", retailer: "Asda", notes: "Add to your grocery shop as required." },
            { category: "Pantry Staples", item: "Sugar", retailer: "Asda", notes: "Add to your grocery shop as required." },
            { category: "Drinks", item: "Coffee Pods (All types)", retailer: "Amazon Subscribe & Save", notes: "Buying packs of 3 or more boxes of Nescafé/Starbucks pods is significantly cheaper than supermarket prices." },
            { category: "Drinks", item: "Diet Coke / Juices", retailer: "Asda", notes: "Look for multi-pack deals and offers." },
            { category: "Snacks", item: "Crackers", retailer: "Asda", notes: "Add to your grocery shop." },
            { category: "Bakery & Cereals", item: "Cereal", retailer: "Asda", notes: "Buy larger boxes for better value per serving." },
            { category: "Dairy & Eggs", item: "Milk", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Dairy & Eggs", item: "Cheese (Mozzarella, etc.)", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Dairy & Eggs", item: "Philadelphia Spreadable Cheese", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Dairy & Eggs", item: "Butter (e.g., Lurpak)", retailer: "Asda", notes: "Stock up when on offer." },
            { category: "Dairy & Eggs", item: "Yogurt", retailer: "Asda", notes: "Buy larger pots for better value." },
            { category: "Dairy & Eggs", item: "Eggs", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Bakery & Cereals", item: "Bread", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Meat, Poultry & Fish", item: "Chicken (Thighs, Drumsticks)", retailer: "Asda", notes: "Larger packs are often better value per kg." },
            { category: "Meat, Poultry & Fish", item: "Minced Chicken", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Meat, Poultry & Fish", item: "Pork Sausages (e.g., Richmond)", retailer: "Iceland / Asda", notes: "Check Iceland for bulk-buy freezer deals." },
            { category: "Meat, Poultry & Fish", item: "Other Meats / Fish", retailer: "Asda", notes: "Buy from the fresh counter or pre-packaged as needed." },
            { category: "Fresh Produce", item: "Bananas", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Apples (e.g., Pink Lady)", retailer: "Asda", notes: "Buy in bags rather than loose for better value." },
            { category: "Fresh Produce", item: "Onions (Red, Brown/White)", retailer: "Asda", notes: "Buy in net bags for better value." },
            { category: "Fresh Produce", item: "Potatoes (Baking, Red)", retailer: "Asda", notes: "2kg bags are a good staple." },
            { category: "Fresh Produce", item: "Carrots", retailer: "Asda", notes: "Buy in bags." },
            { category: "Fresh Produce", item: "Garlic", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Tomatoes (Salad, etc.)", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Cucumber (Standard, Mini)", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Mushrooms (Fresh)", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Fresh Salad Leaves", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Fresh Produce", item: "Courgettes / Aubergines", retailer: "Asda", notes: "Add to your weekly delivery." },
            { category: "Frozen Foods", item: "Frozen Mixed Vegetables", retailer: "Iceland", notes: "Bulk buy large bags from Iceland for the best value (e.g., Birds Eye)." },
            { category: "Frozen Foods", item: "Frozen Peas / Spinach", retailer: "Iceland", notes: "Stock up the freezer with large bags from Iceland." },
            { category: "Frozen Foods", item: "Frozen Chips", retailer: "Iceland", notes: "Iceland has frequent offers on large bags." },
            { category: "Frozen Foods", item: "Frozen Seafood", retailer: "Iceland", notes: "Iceland has a wide variety and good deals on frozen fish and seafood." },
            { category: "Frozen Foods", item: "Frozen Paratha (e.g., Shana)", retailer: "Iceland / Asda", notes: "Check the freezer aisle." },
            { category: "Frozen Foods", item: "Frozen Gyoza (e.g., Itsu)", retailer: "Iceland / Asda", notes: "Check the freezer aisle." },
            { category: "Frozen Foods", item: "Frozen Okra (e.g., Taj Bhindi)", retailer: "Asda", notes: "Check the world foods freezer section." },
            { category: "Toiletries", item: "Hand Soap", retailer: "Amazon", notes: "Buy multi-pack refills to top up dispensers; much cheaper than buying new bottles." },
            { category: "Toiletries", item: "Shower Gel (Men's)", retailer: "Asda", notes: "Look for offers on larger bottles." },
            { category: "Toiletries", item: "Shampoo (Men's)", retailer: "Asda", notes: "Look for offers on larger bottles." },
            { category: "Toiletries", item: "Tissues (e.g., Kleenex, ASDA)", retailer: "Amazon Subscribe & Save", notes: "Buying tissue cube multi-packs on subscription is convenient and cost-effective." },
            { category: "Pet Supplies", item: "Wet Dog Food (e.g., Pedigree)", retailer: "Amazon Subscribe & Save", notes: "Subscribing to a monthly delivery of a 24 or 48-pack of tins is cheaper than buying weekly." },
            { category: "Pet Supplies", item: "Puppy Training Pads", retailer: "Amazon", notes: "Buy in large packs (e.g., 100 pads) for the best price per pad." }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const shoppingListContainer = document.getElementById('shopping-list');
            const categoryFilter = document.getElementById('category-filter');
            const retailerFilter = document.getElementById('retailer-filter');
            const summaryContainer = document.getElementById('summary');
            const addItemForm = document.getElementById('add-item-form');
            const editModal = document.getElementById('edit-modal');
            const editItemForm = document.getElementById('edit-item-form');
            const cancelEditBtn = document.getElementById('cancel-edit');
            const scanAllBtn = document.getElementById('scan-all-btn');

            let chartInstance = null;

            const mockFetchPrice = (itemName, retailer) => {
                return new Promise(resolve => {
                    const randomDelay = 800 + Math.random() * 1200;
                    setTimeout(() => {
                        const basePrice = Math.random() * 8 + 1;
                        let price;
                        if (retailer.toLowerCase().includes('amazon')) {
                            price = basePrice * 0.95;
                        } else if (retailer.toLowerCase().includes('iceland')) {
                            price = basePrice * 1.05;
                        } else {
                            price = basePrice;
                        }
                        resolve({
                            price: `£${price.toFixed(2)}`
                        });
                    }, randomDelay);
                });
            };
            
            const handlePriceScan = async (scanBtn) => {
                const index = parseInt(scanBtn.dataset.index, 10);
                const item = shoppingData[index];
                const card = scanBtn.closest('.bg-stone-50');
                const priceDisplay = card.querySelector('.price-display');
                
                scanBtn.disabled = true;
                const icon = scanBtn.querySelector('svg');
                icon.classList.add('animate-spin');
                priceDisplay.textContent = 'Scanning...';

                try {
                    const result = await mockFetchPrice(item.item, item.retailer);
                    priceDisplay.textContent = result.price;
                } catch (error) {
                    priceDisplay.textContent = 'Error';
                } finally {
                    scanBtn.disabled = false;
                    icon.classList.remove('animate-spin');
                }
            };

            const renderItems = (items) => {
                shoppingListContainer.innerHTML = '';
                if (items.length === 0) {
                    shoppingListContainer.innerHTML = `<p class="text-gray-500 md:col-span-2 text-center">No items match your selected filters.</p>`;
                    return;
                }
                items.forEach((item) => {
                    const originalIndex = shoppingData.indexOf(item);
                    const itemCard = `
                        <div class="bg-stone-50 border border-stone-200 rounded-lg p-4 flex flex-col justify-between">
                            <div>
                                <p class="text-sm font-medium text-[#A88B79]">${item.category}</p>
                                <h3 class="text-lg font-bold text-[#6D5D53] mt-1">${item.item}</h3>
                                <p class="text-sm text-gray-600 mt-2">${item.notes || 'No notes'}</p>
                            </div>
                            <div class="mt-4 pt-3 border-t border-stone-200">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-semibold text-gray-700 bg-stone-200 rounded-full px-3 py-1">${item.retailer}</span>
                                    <span class="price-display text-lg font-bold text-[#6D5D53]"></span>
                                </div>
                                <div class="flex justify-end items-center gap-2 mt-3">
                                    <button class="scan-btn text-gray-400 hover:text-[#A88B79]" data-index="${originalIndex}" title="Scan for latest price">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" /></svg>
                                    </button>
                                    <button class="edit-btn text-gray-400 hover:text-[#A88B79]" data-index="${originalIndex}" title="Edit item">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
                                    </button>
                                    <button class="delete-btn text-gray-400 hover:text-red-500" data-index="${originalIndex}" title="Delete item">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    shoppingListContainer.insertAdjacentHTML('beforeend', itemCard);
                });
            };
            
            const getFilteredData = () => {
                const selectedCategory = categoryFilter.value;
                const selectedRetailer = retailerFilter.value;
                let filteredData = shoppingData;

                if (selectedCategory !== 'all') {
                    filteredData = filteredData.filter(d => d.category === selectedCategory);
                }
                if (selectedRetailer !== 'all') {
                    filteredData = filteredData.filter(d => d.retailer.includes(selectedRetailer));
                }
                return filteredData;
            };

            const updateUI = () => {
                const uniqueCategories = [...new Set(shoppingData.map(d => d.category))].sort();
                const uniqueRetailers = [...new Set(shoppingData.flatMap(d => d.retailer.split(' / ')))].sort();
                
                const currentCat = categoryFilter.value;
                categoryFilter.innerHTML = '<option value="all">All Categories</option>';
                uniqueCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    categoryFilter.appendChild(option);
                });
                if (uniqueCategories.includes(currentCat)) categoryFilter.value = currentCat;
                
                const currentRet = retailerFilter.value;
                retailerFilter.innerHTML = '<option value="all">All Retailers</option>';
                 uniqueRetailers.forEach(ret => {
                    const option = document.createElement('option');
                    option.value = ret;
                    option.textContent = ret;
                    retailerFilter.appendChild(option);
                });
                if (uniqueRetailers.includes(currentRet)) retailerFilter.value = currentRet;

                const retailersCount = calculateSummary(uniqueRetailers);
                renderChart(retailersCount);
                renderItems(getFilteredData());
            };
            
            const calculateSummary = (uniqueRetailers) => {
                const totalItems = shoppingData.length;
                const retailersCount = {};
                uniqueRetailers.forEach(r => retailersCount[r] = 0);
                
                shoppingData.forEach(d => {
                    uniqueRetailers.forEach(r => {
                        if (d.retailer.includes(r)) {
                            retailersCount[r]++;
                        }
                    });
                });

                summaryContainer.innerHTML = `
                    <div class="bg-white p-4 rounded-lg shadow text-center">
                        <p class="text-2xl font-bold text-[#A88B79]">${totalItems}</p>
                        <p class="text-sm text-gray-500">Total Items</p>
                    </div>
                `;
                
                const statColors = ['#6D5D53', '#8C7B70', '#A88B79', '#C4B5A5'];
                let colorIndex = 0;
                
                Object.entries(retailersCount).forEach(([retailer, count]) => {
                     const color = statColors[colorIndex % statColors.length];
                     summaryContainer.innerHTML += `
                        <div class="bg-white p-4 rounded-lg shadow text-center">
                            <p class="text-2xl font-bold" style="color:${color};">${count}</p>
                            <p class="text-sm text-gray-500">${retailer}</p>
                        </div>
                    `;
                    colorIndex++;
                });

                return retailersCount;
            };

            const renderChart = (retailersCount) => {
                if (chartInstance) {
                    chartInstance.destroy();
                }
                const ctx = document.getElementById('retailerChart').getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(retailersCount),
                        datasets: [{
                            label: 'Items per Retailer',
                            data: Object.values(retailersCount),
                            backgroundColor: ['#A88B79', '#C4B5A5', '#6D5D53', '#8C7B70', '#FDFBF8'],
                            borderColor: '#FFFFFF',
                            borderWidth: 2,
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { family: 'Inter', size: 12 }
                                }
                            }
                        }
                    }
                });
            };
            
            addItemForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const newItem = {
                    item: document.getElementById('item-name').value.trim(),
                    category: document.getElementById('item-category').value.trim(),
                    retailer: document.getElementById('item-retailer').value.trim(),
                    notes: document.getElementById('item-notes').value.trim(),
                };
                shoppingData.push(newItem);
                addItemForm.reset();
                updateUI();
            });

            shoppingListContainer.addEventListener('click', (e) => {
                const scanBtn = e.target.closest('.scan-btn');
                const editBtn = e.target.closest('.edit-btn');
                const deleteBtn = e.target.closest('.delete-btn');

                if(scanBtn) {
                    handlePriceScan(scanBtn);
                }

                if (editBtn) {
                    const index = parseInt(editBtn.dataset.index, 10);
                    const item = shoppingData[index];
                    document.getElementById('edit-item-index').value = index;
                    document.getElementById('edit-item-name').value = item.item;
                    document.getElementById('edit-item-category').value = item.category;
                    document.getElementById('edit-item-retailer').value = item.retailer;
                    document.getElementById('edit-item-notes').value = item.notes;
                    editModal.classList.remove('hidden');
                    editModal.classList.add('flex');
                }

                if (deleteBtn) {
                    const index = parseInt(deleteBtn.dataset.index, 10);
                    shoppingData.splice(index, 1);
                    updateUI();
                }
            });

            scanAllBtn.addEventListener('click', () => {
                const visibleScanBtns = shoppingListContainer.querySelectorAll('.scan-btn');
                visibleScanBtns.forEach((btn, index) => {
                    setTimeout(() => {
                        if (!btn.disabled) {
                           handlePriceScan(btn);
                        }
                    }, index * 200);
                });
            });

            editItemForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const index = parseInt(document.getElementById('edit-item-index').value, 10);
                shoppingData[index] = {
                    item: document.getElementById('edit-item-name').value.trim(),
                    category: document.getElementById('edit-item-category').value.trim(),
                    retailer: document.getElementById('edit-item-retailer').value.trim(),
                    notes: document.getElementById('edit-item-notes').value.trim(),
                };
                editModal.classList.add('hidden');
                editModal.classList.remove('flex');
                updateUI();
            });

            cancelEditBtn.addEventListener('click', () => {
                editModal.classList.add('hidden');
                editModal.classList.remove('flex');
            });
            
            categoryFilter.addEventListener('change', () => renderItems(getFilteredData()));
            retailerFilter.addEventListener('change', () => renderItems(getFilteredData()));
            
            updateUI();
        });
    </script>
</body>
</html>

